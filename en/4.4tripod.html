<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>tripod - yu book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="1.介绍.html"><strong aria-hidden="true">1.</strong> Introduce</a></li><li class="chapter-item expanded "><a href="2.快速开始.html"><strong aria-hidden="true">2.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="3.基本原理.html"><strong aria-hidden="true">3.</strong> Fundamental</a></li><li class="chapter-item expanded "><a href="4.0组件.html"><strong aria-hidden="true">4.</strong> Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4.1blockchain.html"><strong aria-hidden="true">4.1.</strong> blockchain</a></li><li class="chapter-item expanded "><a href="4.2txdb.html"><strong aria-hidden="true">4.2.</strong> txdb</a></li><li class="chapter-item expanded "><a href="4.3txpool.html"><strong aria-hidden="true">4.3.</strong> txpool</a></li><li class="chapter-item expanded "><a href="4.4tripod.html" class="active"><strong aria-hidden="true">4.4.</strong> tripod</a></li><li class="chapter-item expanded "><a href="4.5state.html"><strong aria-hidden="true">4.5.</strong> state</a></li><li class="chapter-item expanded "><a href="4.6p2p.html"><strong aria-hidden="true">4.6.</strong> p2p</a></li></ol></li><li class="chapter-item expanded "><a href="5.0dev.html"><strong aria-hidden="true">5.</strong> Development Manual</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5.1配置文件.html"><strong aria-hidden="true">5.1.</strong> Config File</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5.1.1节点配置.html"><strong aria-hidden="true">5.1.1.</strong> Node Config</a></li><li class="chapter-item expanded "><a href="5.1.2各组件配置.html"><strong aria-hidden="true">5.1.2.</strong> Config of each component</a></li><li class="chapter-item expanded "><a href="5.1.3P2P网络配置.html"><strong aria-hidden="true">5.1.3.</strong> Config of P2P</a></li></ol></li><li class="chapter-item expanded "><a href="5.2context与chainEnv.html"><strong aria-hidden="true">5.2.</strong> Context and chainEnv</a></li><li class="chapter-item expanded "><a href="5.3Writing_and_query.html"><strong aria-hidden="true">5.3.</strong> Writing and Reading</a></li><li class="chapter-item expanded "><a href="5.4区块周期.html"><strong aria-hidden="true">5.4.</strong> block life cycle</a></li><li class="chapter-item expanded "><a href="5.5建立区块链网络.html"><strong aria-hidden="true">5.5.</strong> Build Blockchain Network</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5.5.1节点1.html"><strong aria-hidden="true">5.5.1.</strong> node1 Conf</a></li><li class="chapter-item expanded "><a href="5.5.2节点2.html"><strong aria-hidden="true">5.5.2.</strong> node2 Conf</a></li><li class="chapter-item expanded "><a href="5.5.3节点3.html"><strong aria-hidden="true">5.5.3.</strong> node3 Conf</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">yu book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#tripod" id="tripod">Tripod</a></h1>
<h4><a class="header" href="#description" id="description">Description</a></h4>
<p><code>tripod</code> is the core of the entire yu framework, and developers define their own business logic by implementing its interface. It consists of three parts:</p>
<ol>
<li>Custom block verification rules and transaction checking logic.</li>
<li>Control the life cycle of blocks to achieve deep customization development. The life cycle has four phases: <code>initChain</code>, <code>startBlock</code>, <code>endBlock</code>, <code>finalizeBlock</code>. where only <code>initChain</code>
It is called only at the time of the genesis block, and the last three are called every block. (Personalized consensus algorithms can be implemented with the block life cycle)</li>
<li>Customize <code>Transaction</code>(Writing), <code>Query</code>(Query) and <code>P2P Request Handling</code> (p2pHandler) </li>
</ol>
<h4><a class="header" href="#interface" id="interface">Interface</a></h4>
<p>Code is <a href="https://github.com/yu-org/yu/blob/master/core/tripod/tripod.go">here</a></p>
<pre><code class="language-go">func Name() string
func SetChainEnv(env *ChainEnv)
</code></pre>
<p><code>Name()</code> returns the name of <code>tripod</code>。<br />
<code>SetChainEnv(*ChainEnv)</code> loads <code>ChainEnv</code> into <code>tripod</code>, which is convenient for subsequent calls. (<code>ChainEnv</code> is introduced in <a href="5.2context%E4%B8%8EchainEnv.html">context and chainEnv</a>)</p>
<h2><a class="header" href="#" id=""></a></h2>
<pre><code class="language-go">func CheckTxn(*SignedTxn) error
func VerifyBlock(block *Block) bool
</code></pre>
<p><code>checkTxn()</code> is a developer-defined transaction check logic. As mentioned in the previous chapter, when an external transaction is inserted into <code>txpool</code>, the two steps of <code>BaseChack</code> and <code>TripodsCheck</code> will be executed.
And <code>TripodsCheck</code> is defined here, each <code>tripod</code> can define its own transaction check logic.</p>
<p><code>VerifyBlock()</code> is a developer-defined block verification logic. Every time the blockchain receives a block from external broadcast, it needs to be verified before it can be processed. Different chains have different verifications for blocks. test method, so
Developers can customize the validation logic by themselves. Each <code>tripod</code> can define its own transaction checking logic.</p>
<h2><a class="header" href="#-1" id="-1"></a></h2>
<pre><code class="language-go">func InitChain() error
func StartBlock(block *Block) (needBroadcast bool, err error)
func EndBlock(block *Block) error
func FinalizeBlock(block *Block) error
</code></pre>
<p><code>InitChain()</code> will only be called once when the blockchain is started, and it is specially used to define and process the <code>genesis block</code>.<br />
<code>StartBlock()</code> defines the logic of the stage when the block is generated, and needs to return a <code>needBroadcast</code> return value of type <code>bool</code> to tell the framework whether the block needs to be broadcast. Generally, if it is a locally mined block, it needs to be broadcast, if it is from other nodes
The acquired block does not need to be broadcast.<br />
<code>EndBlock()</code> defines the logic at the end of the block, where the transaction is generally executed and the block is stored in the blockchain.<br />
<code>FinalizeBlock()</code> defines the logic of the block's <code>finalize phase</code> (i.e. final consensus). If the blockchain is a <code>finalize type chain</code>, you need to customize this part of the logic, otherwise it is not necessary.</p>
<h3><a class="header" href="#dependency-injection" id="dependency-injection">Dependency Injection</a></h3>
<p>We may develop many Tripods in yu, and there may be dependencies between different Tripods. For example, when a developer develops a Tripod named <code>staking</code>, it may need to rely on the <code>asset</code> Tripod.
In order to facilitate developers to manage Tripod dependencies more conveniently. yu provides the function of dependency injection.</p>
<pre><code class="language-go">type Staking struct {
	*tripod.Tripod
	asset *asset.Asset `tripod:&quot;asset&quot;`
}
</code></pre>
<p>As shown above, it is known that we already have an <a href="https://github.com/yu-org/yu/blob/master/apps/asset/transfer.go">Asset Tripod</a>. Now we develop the pledge module, which needs to rely on the assets in the asset
Some functions, then we only need to declare the asset variable in the Staking structure and add a tag (<code>tripod:&quot;asset&quot;</code>).
This is a fixed syntax <code>tripod:&lt;TripodName&gt;</code>, after adding, we just need to start yu normally:</p>
<pre><code class="language-go">    startup.StartUp(Staking.New(), asset.NewAsset())
</code></pre>
<p>Simple as above. startup() is a necessary step to start yu, you only need to call it once in your code, Startup() will automatically load these Tripods and complete dependency injection at runtime.</p>
<h2><a class="header" href="#land" id="land">land</a></h2>
<p><code>land</code> is used to load all <code>tripod</code>s for the framework to call.</p>
<h4><a class="header" href="#land-internal-flow-chart" id="land-internal-flow-chart"><code>land</code> internal flow chart</a></h4>
<p><img src="land%E5%86%85%E9%83%A8%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="image" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="4.3txpool.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="4.5state.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="4.3txpool.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="4.5state.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
